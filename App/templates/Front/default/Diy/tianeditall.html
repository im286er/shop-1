<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="ie-stand">
    <title>3DCITY-DIY-甜甜圈-18K金彩宝耳钉</title>
    <link href="__NEOSTATIC__/css/jquery-ui.min.css" type="text/css" rel="stylesheet" />
    <script src="__NEOSTATIC__/js/ZBasic.js"></script>
    <script src="__NEOSTATIC__/js/json2.js"></script>
    <script src="__NEOSTATIC__/diy/seajs-2.3.0/dist/sea-debug.js" type="text/javascript"></script>
    <script src="__NEOSTATIC__/js/jquery-1.11.2.min.js" type="text/javascript"></script>
    <script src="__NEOSTATIC__/js/jquery-ui.min.js" type="text/javascript"></script>
    <!--<script src="__NEOSTATIC__/js/farbtastic/farbtastic.js" type="text/javascript"></script>-->
    <!--<link href="__NEOSTATIC__/js/farbtastic/farbtastic.css" type="text/css" rel="stylesheet" />-->
    <link href="__NEOSTATIC__/css/diy_ddd_common.css" type="text/css" rel="stylesheet" />
    <link href="__NEOSTATIC__/css/diy_tian.css" type="text/css" rel="stylesheet" />
    <script src="__NEOSTATIC__/diy/config.js" type="text/javascript"></script>

</head>

<body>
<div id="editor">
    <form id="diyf" name="diyf" method="post" role="form" onSubmit="return false;">
    <div id="edt_preview"></div>
    <div id="edt_control">
        <p class="edt_prd_title"><{$dataAll.diy_cate.cate_name}><span>DIY</span></p>
        <p class="edt_prd_desc"><{$dataAll.diy_cate.intro1}></p>
        <p class="edt_prd_promotion"></p>
        <div class="edt_prd_price">
            <span class=" priceText">￥<span id="showprice"><{$udinfo.price}></span>.00</span>
            <div class="edt_prd_like" id="zan" pid="<{$productInfo.p_id}>"><i id="zannum"><{$productInfo.p_zans}></i></div>
        </div>
        <div class="edt_space"></div>
        <div id="edt_ctr">
            <div class="earring_diamond">
                <div class="earring_style">
                    <{$keyi=0}>
                        <{foreach $dataAll.diy_unit as $item}>
                        <{if $keyi == 1}>
                            <div class="earring_left add_pic" ></div>
                        <{/if}>

                        <div class="earring_left earring_style_item" id="<{$item.unit_name}>_group" <{if $item.fieldvalue_visiable == 0}>style="display: none;"<{/if}>>
                            <span class="tit"><{$item.unit_showname}>
                                <{if $keyi == 0}>
                                    <em class="remove-ring" id="remove_inner" unitid="<{$item.id}>"></em>
                                <{else}>
                                    <em class="remove-ring" id="remove_outer" unitid="<{$item.id}>"></em>
                                <{/if}>
                            </span>
                            <div class="pic edt_diamonds_pos" id="<{$item.unit_name}>" groupId="<{$item.diamondpos}>" metal="<{$item.fieldvalue_material}>" unitId="<{$item.id}>">
                                <div class="edt_pos_diamond" posnum="0" diamond="<{$item.fieldvalue}>" groupId="<{$item.diamondpos}>"></div>
                                <input type="hidden" value="<{$item.fieldvalue}>" id="pos_<{$item.diamondpos}>" name="<{$item.unit_name}>">
                                <input type="hidden" value="<{$item.fieldvalue_material}>" id="pos_material_<{$item.diamondpos}>" name="<{$item.unit_name}>_material">
                                <input type="hidden" value="<{$item.fieldvalue_visiable}>" id="<{$item.unit_name}>_visiable" name="<{$item.unit_name}>_visiable">
                            </div>
                        </div>
                        <{if $keyi == 1}>
                            <div class="earring_left" style="display:none;" id="add_outer_group">
                                <span class="tit">添加外圈</span>
                                <div class="pic add-ring" id="add_outer"></div>
                            </div>
                        <{else}>
                            <div class="earring_left" style="display:none" id="add_inner_group">
                                <span class="tit">添加内圈</span>
                                <div class="pic add-ring" id="add_inner"></div>
                            </div>
                        <{/if}>
                        <{$keyi=$keyi+1}>
                        <{/foreach}>
                </div>

                <div class="splitLine">
                    <div class="arrow"></div>
                </div>
                <div id="part_selector_diamond" class="part_selector_item">
                    <div class="part_unit" id="part_unit_diamond">
                        <span class="unit_name">彩宝</span>
                        <div class="selected_icon diamond_common_red" id="diamondCurrentIcon"></div>
                        <span class="selected_name" id="diamondCurrentText">红宝石</span>
                        <div class="the-arrow-normal" id="the-arrow-diamond"></div>
                    </div>
                </div>
                <div id="edt_diamond_shop-g" class="edt_dropdown">
                    <div id="edt_diamond_shop" class="edt_list_select">
                        <{$tkey=0}>
                        <{foreach from=$diamondinfo key=Id item=item}>
                            <div id="edt_diamond_shop_<{$Id}>">
                                <{$tkey=$tkey+1}>
                                <{foreach from=$item key=myId item=result}>
                                    <div class="edt_shop_diamond" diamond="<{$result.id}>" title="<{$result.dname}>" pos="<{$Id}>" dp="<{$result.price}>">
                                        <div class="<{$result.style}>_30"></div>
                                    </div>
                                <{/foreach}>
                            </div>
                        <{/foreach}>
                    </div>
                </div>
            </div>

            <div class="earring_metal">
                <!--<div><span class="tit">请选择材质</span></div>-->
                <div id="part_selector_metal" class="part_selector_item">
                    <div class="part_unit" id="part_unit_metal">
                        <span class="unit_name">材质</span>
                        <div class="selected_icon metal_gold_red" id="materialCurrentIcon"></div>
                        <span class="selected_name" id="materialCurrentText">18K黄金</span>
                        <div class="the-arrow-normal" id="the-arrow-metal"></div>
                    </div>
                    <div id="edt_ctr_metal_g">
                        <div id="edt_ctr_metal" class="edt_dropdown">
                            <div metal="18K_gold" class="edt_metal_c metal_gold_yellow" idx="130" title="18K黄金"></div>
                            <div metal="18K_white" class="edt_metal_c metal_gold_white" idx="129" title="18K白金"></div>
                            <div metal="18K_rosy" class="edt_metal_c metal_gold_red" idx="128" title="18K玫瑰金"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="btn_box">
            <button type="button" class="btn-buy btn-default arcbuynow"  id="web3dSaveBuy" data-loading-text="<span class='' aria-hidden='true' style='display:inline-block;float:left;height:45px;line-height:45px;padding:0 5px 0 0;'>
            <img src='__NEOSTATIC__/imgs/jewelry/loading.gif' width='20' height='20'/></span>正在提交..." autocomplete="off">放入购物袋</button>
            <input type="hidden" value="<{$udinfo.id}>" name="pid" id="pid"></p>
            <input type="hidden" value="<{$udinfo.cover}>" name="cover" id="cover">
            <input type="hidden" value="<{$dataAll.diy_cate.cid}>" name="cid" id="cid">
            <input type="hidden" value="<{$udinfo.price}>" name="price" id="price">
            <input type="hidden" value="0" id="stype" name="stype">
        </div>
        <div class="my_operation">

            <a href="javascript:void(0);"  class="btn_save" id="web3dSave" >保存我的方案</a>
            <!--<i></i>-->
            <!--<a href="javascript:;" class="btn_share">分享</a>-->
        </div>


    </div>
</form>
</div>
<script type="text/javascript">

    seajs.use(["3dcity/earrings/ZEntry.js", "common/ZPost.js", "common/gui/ZDDDPublic"], function(ZEntry, ZPost, ZDDDPublic) {
        var _parent = document.getElementById("edt_preview"), i;

        var dddPublic = new ZDDDPublic(_parent);

        // the default is active inner
        dddPublic.activePart2($('#earring_inner'));

        // bind each part click event
        $(".edt_diamonds_pos").each(function () {
            $(this).on("click", function (event) {
                dddPublic.activePart2($(this));
                event.stopPropagation();
            });
        });

        var diamondPrice=<{$diamondPriceJson}>;
        getprice(diamondPrice);
        visiableshow();

        // bind each diamond click event
        $(".edt_shop_diamond").each(function (){
            $(this).on("click", function (event) {
                dddPublic.activeDiamondBar($(this));
                //console.log(this);
                var pos = this.getAttribute('pos');
                var price=this.getAttribute('dp');
                diamondPrice[pos]['diamond_price']=price;
                getprice(diamondPrice);
                event.stopPropagation();
            });
        });

        function visiableshow(){
            if($("#earring_inner_group").is(':hidden')) {
                $("#add_inner_group").show();
                $("#remove_outer").hide();
            } else {
                $("#add_outer_group").hide();
                $("#remove_outer").show();
            }

            if($("#earring_outer_group").is(':hidden')) {
                $("#add_outer_group").show();
                $("#remove_inner").hide();
            } else {
                $("#add_outer_group").hide();
                $("#remove_inner").show();
            }
        }
        function getprice(priceArr){
            console.log(priceArr);
            var price=0;
            for(key in priceArr){
                price =price + (parseInt(priceArr[key]['price']) + parseInt(priceArr[key]['diamond_price'])*parseInt(priceArr[key]['diamond_num']))*parseInt(priceArr[key]['visiable']);
            }
            document.getElementById('showprice').innerHTML=price;
            document.getElementById('price').value=price;
            // alert('abc');
        }

        $("#part_unit_diamond").on("click", function (event) {

            dddPublic.activeCom($("#edt_diamond_shop-g"), $("#the-arrow-diamond"));
            event.stopPropagation();

        });

        $("#part_unit_metal").on("click", function (event) {

            dddPublic.activeCom($("#edt_ctr_metal"), $("#the-arrow-metal"));
            event.stopPropagation();

        });

        $(".edt_metal_c").each(function () {
            $(this).on("click", function (event) {
                dddPublic.activeMetalBar($(this));
                event.stopPropagation();
            });
        });

        $("#remove_inner").on("click", function(event) {
            $("#earring_inner_visiable").val(0);
            var pos=this.getAttribute("unitid");
            diamondPrice[pos]["visiable"]=0;
            getprice(diamondPrice);
            $("#earring_inner_group").hide();
            $("#add_inner_group").show();
            dddPublic.activePart2($('#earring_outer'));
            $('.edt_list_select').children('div').removeClass();
            $("#remove_outer").hide();
            event.stopPropagation();
        });

        $("#add_inner").on("click", function(event) {
            $("#earring_inner_visiable").val(1);
            var pos=$("#remove_inner").attr("unitid");
            diamondPrice[pos]["visiable"]=1;
            getprice(diamondPrice);
            $("#add_inner_group").hide();
            $("#earring_inner_group").show();
            dddPublic.activePart2($('#earring_inner'));
            $("#remove_outer").show();
            event.stopPropagation();
        });


        $("#remove_outer").on("click", function(event) {
            $("#earring_outer_visiable").val(0);
            var pos=this.getAttribute("unitid");
            diamondPrice[pos]["visiable"]=0;
            getprice(diamondPrice);
            $("#earring_outer_group").hide();
            $("#add_outer_group").show();
            dddPublic.activePart2($('#earring_inner'));
            $('.edt_list_select').children('div').removeClass();
            $("#remove_inner").hide();
            event.stopPropagation();
        });

        $("#add_outer").on("click", function(event) {
            $("#earring_outer_visiable").val(1);
            var pos=$("#remove_outer").attr("unitid");
            diamondPrice[pos]["visiable"]=1;
            getprice(diamondPrice);
            $("#add_outer_group").hide();
            $("#earring_outer_group").show();
            dddPublic.activePart2($('#earring_outer'));
            $("#remove_inner").show();
            event.stopPropagation();
        });

        $(function(){
            $("#zan").click(function(){
                var zan =$(this);
                var pid = zan.attr("pid"); //对应id
                zan.css("opacity",0);
                zan.animate({opacity:1});
                $.ajax({
                    type:"GET",
                    url:"__USERIDX__/myzan/add/id/"+pid,
                    data:"",
                    cache:false, //不缓存此页面
                    success:function(data){
                        $('#zannum').html(data);
                    }
                });
                return false;
            });
        });
//        var saveElement = document.getElementById("web3dSave");
//        if(saveElement !== null) {
//            saveElement.onclick = function(event){
//               // alert("abc");
//                document.getElementById("stype").value=0;
//                ZPost.canvasScreenshot(_parent.children[0], 21, true);
//                event.stopPropagation();
//            };
//        }
//
//        var saveElementBuy = document.getElementById("web3dSaveBuy");
//        if(saveElementBuy !== null) {
//            saveElementBuy.onclick = function(event){
//                document.getElementById("stype").value=1;
//                ZPost.canvasScreenshot(_parent.children[0], 21, true);
//                event.stopPropagation();
//            };
//        }



        var inParas = {
            projectName: "__NEOSTATIC__/diy/assets/3dcity/projects/earrings/02/02.project",
            projectName_nowebgl: "__NEOSTATIC__/diy/assets/nowebgl/projects/earrings/02/02.project",
            elementParent : _parent
        };
        var zEntry = new ZEntry(inParas);

    });

</script>
<!--<script src="js/nowebgl.js"></script>-->
</body>
</html>
