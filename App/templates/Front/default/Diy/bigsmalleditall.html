<html>
<head>
    <meta charset="utf-8">
    <link href="__NEOSTATIC__/css/scojs.css" rel="stylesheet">
    <!--<link href="__NEOSTATIC__/css/bootstrap.css" rel="stylesheet">-->
    <script src="__NEOSTATIC__/js/ZBasic.js"></script>
    <script src="__NEOSTATIC__/js/json2.js"></script>
    <script src="__NEOSTATIC__/diy/seajs-2.3.0/dist/sea.js" type="text/javascript"></script>
    <script src="__NEOSTATIC__/js/jquery-1.11.2.min.js" type="text/javascript"></script>
    <script src="__NEOSTATIC__/js/sco.panes.js"></script>
    <script src="__NEOSTATIC__/js/sco.tab.js"></script>
    <!--<link href="__NEOSTATIC__/css/bootstrap-responsive.min.css" rel="stylesheet">-->
    <!--<script src="__NEOSTATIC__/js/bootstrap.min.js"></script>-->
    <link href="__NEOSTATIC__/css/diy_ddd_common.css" type="text/css" rel="stylesheet"/>
<!--
    <link href="__NEOSTATIC__/css/diy_ddd_ring_common.css" type="text/css" rel="stylesheet"/>
-->
    <script src="__NEOSTATIC__/diy/config.js" type="text/javascript"></script>
          <!-- <link href="__NEOSTATIC__/css/diy_bigsmall.css" rel="stylesheet">-->

         <link href="__NEOSTATIC__/css/<{$dataAll.diy_cate.idprefix}>" rel="stylesheet">


</head>
<body>
<div id="editor">
    <form id="diyf" name="diyf" method="post" role="form" onSubmit="return false;">
    <div id="edt_preview"></div>
    <div id="edt_control">
        <p class="edt_prd_title"><{$dataAll.diy_cate.cate_name}><span>DIY</span></p>

        <p class="edt_prd_desc"><{$dataAll.diy_cate.intro1}></p>

        <p class="edt_prd_promotion">购买本款耳钉满2000元立减300元</p>

        <div class="edt_prd_price">
            <span class=" priceText">￥<span id="showprice"><{$udinfo.price}></span>.00</span>
            <div class="edt_prd_like"></div>
        </div>
        <div class="edt_space"></div>
        <div id="edt_ctr">
            <div class="earring_style">
                <div class="earring_style_item">
                    <span class="tit">请选择宝石</span>

                    <div class="edt_diamonds_pos" groupId="0" metal="128">
                        <{$i=0}>
                <{foreach $dataAll.diy_unit as $item}>
                    <{if $item.fieldtype eq 'DIAMOND'}>
                        <{if $dataAll.diy_cate.cid eq 40 or $dataAll.diy_cate.cid eq 39 }>
                            <{if $i==0 }>
                                <div class="edt_pos_diamond" pos="<{$item.id}>" posnum="<{$i}>" diamond="<{$item.fieldvalue}>" groupid="0" unitid="<{$item.id}>">
                                    <div></div>
        <!--<input type="text" value="<{$item.fieldvalue}>" id="pos_<{$item.diamondpos}>" name="<{$item.unit_name}>">-->
                                </div>

                                <div class="edt_pos_diamond big" id="big_01" posnum="0" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                                <div class="edt_pos_diamond big" id="big_02" posnum="0" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                                <div class="edt_pos_diamond big" id="big_03" posnum="0" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                                <div class="edt_pos_diamond big" id="big_04" posnum="0" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                                <div class="edt_pos_diamond big" id="big_05" posnum="0" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>

                            <{else}>
                                <div class="edt_pos_diamond" pos="<{$item.id}>" posnum="<{$i}>" diamond="<{$item.fieldvalue}>" groupid="0" unitid="<{$item.id}>">
                                <div></div>
        <!--
                                    <input type="text" value="<{$item.fieldvalue}>" id="pos_<{$item.diamondpos}>" name="<{$item.unit_name}>">
        -->
                                </div>
                                <div class="edt_pos_diamond small" id="small_01" posnum="1" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                                <div class="edt_pos_diamond small" id="small_02" posnum="1" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                                <div class="edt_pos_diamond small" id="small_03" posnum="1" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                                <div class="edt_pos_diamond small" id="small_04" posnum="1" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                                <div class="edt_pos_diamond small" id="small_05" posnum="1" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                                <div class="edt_pos_diamond small" id="small_06" posnum="1" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                                <{if $dataAll.diy_cate.cid eq 40}>
                                    <div class="edt_pos_diamond small" id="small_07" posnum="1" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                        <div class="diamond_common_white"></div>
                                    </div>
                                    <div class="edt_pos_diamond small" id="small_08" posnum="1" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                        <div class="diamond_common_white"></div>
                                    </div>
                                <{/if}>
                            <{/if}>
                        <{else}>
                            <{section name=loop loop=12}>
                                <{$tempIndex=$smarty.section.loop.index+1}>
                                <{if $tempIndex < 10}><{$tempIndex="0"|cat:$tempIndex}><{/if}>
                                <{$posID=$item.unit_name|cat:"_"|cat:$tempIndex}>
                                <div class="edt_pos_diamond" id="<{$posID}>" posnum="<{$i}>" diamond="<{$item.fieldvalue}>" groupid="0" pos="<{$item.id}>">
                                    <div></div>
                                </div>
                            <{/section}>
                        <{/if}>
                        <input type="hidden" value="<{$item.fieldvalue}>" id="pos_<{$item.diamondpos}>" name="<{$item.unit_name}>">
                        <{$i=$i+1}>
                        <{/if}>
                        <{/foreach}>
                    </div>
                </div>
                <div class="splitLine" style="margin-bottom: 18px;">
                    <div class="arrow" style="left: 47%"></div>
                </div>
                <div id="edt_diamond_shop" class="edt_list_select">
                    <{foreach from=$diamondinfo key=Id item=item}>
                    <div id="edt_diamond_shop_<{$Id}>">
                        <{foreach from=$item key=myId item=result}>
                        <div class="edt_shop_diamond" diamond="<{$result.id}>" title="<{$result.dname}>" pos="<{$Id}>" dp="<{$result.price}>">
                            <div class="<{$result.style}>_30"></div>
                        </div>
                        <{/foreach}>
                    </div>
                    <{/foreach}>


                    <div class="edt_shop_diamond" diamond="85" title="白宝石">
                        <div></div>
                    </div>
                    <div class="edt_shop_diamond" diamond="86" title="红宝石">
                        <div class="diamond_common_red"></div>
                    </div>
                    <div class="edt_shop_diamond" diamond="87" title="蓝宝石">
                        <div class="diamond_common_blue"></div>
                    </div>
                    <div class="edt_shop_diamond" diamond="88" title="粉宝石">
                        <div class="diamond_common_pink"></div>
                    </div>
                    <div class="edt_shop_diamond" diamond="89" title="黄宝石">
                        <div class="diamond_common_yellow"></div>
                    </div>
                    <div class="edt_shop_diamond" diamond="90" title="绿宝石">
                        <div class="diamond_common_green"></div>
                    </div>
                </div>
            </div>
            <div class="edt_space"></div>
            <{foreach $dataAll.diy_unit as $item}>
                <{if $item.fieldtype eq 'MATERIAL'}>
                    <div class="earring_metal">
                        <div><span class="tit">请选择材质与手寸</span></div>
                        <div id="part_selector_metal" class="part_selector_item">
                            <div class="part_unit" id="part_unit_metal">
                                <span class="unit_name">材质</span>
                                <div class="selected_icon" id="materialCurrentIcon"></div>
                                <span class="selected_name" id="materialCurrentText"><{$item.fieldvalue_name}></span>
                                <div class="the-arrow the-arrow-normal" id="the-arrow-metal"></div>
                            </div>
                            <{if $dataAll.diy_cate.cid eq 48 }>
                                <div id="edt_ctr_metal_g" class="edt_list_select">
                                    <div id="edt_ctr_metal" class="edt_dropdown">
                                        <div metal="18K_gold" class="edt_metal_c metal_gold_yellow" idx="130" title="18K黄金"></div>
                                        <div metal="18K_white" class="edt_metal_c metal_gold_white" idx="129" title="18K白金"></div>
                                        <div metal="18K_rosy" class="edt_metal_c metal_gold_red" idx="128" title="18K玫瑰金"></div>
                                        <input type="hidden" name="<{$item.unit_name}>" value="<{$item.fieldvalue}>" id="material">
                                    </div>
                                </div>
                            <{else}>
                                <div id="edt_ctr_metal_g_re">
                                    <div id="edt_ctr_metal_g" class="edt_dropdown">
                                        <div id="edt_ctr_metal">
                                            <div metal="18K_gold" class="edt_metal_c metal_gold_yellow" idx="130" title="18K黄金"></div>
                                            <div metal="18K_white" class="edt_metal_c metal_gold_white" idx="129" title="18K白金"></div>
                                            <div metal="18K_rosy" class="edt_metal_c metal_gold_red" idx="128" title="18K玫瑰金"></div>
                                            <input type="hidden" name="<{$item.unit_name}>" value="<{$item.fieldvalue}>" id="material">
                                        </div>
                                    </div>
                                </div>
                            <{/if}>
                        </div>
                    </div>
                <{elseif $item.fieldtype eq 'SELECT'}>
                    <div id="part_selector_size" class="part_selector_item">
                        <div class="part_unit" id="part_unit_size">
                            <span class="unit_name">手寸<{$result.value}></span>
                            <!--<div class="selected_icon" id="materialCurrentIcon"></div>-->
                            <span class="selected_name" id="sizeCurrentText"><{$item.fieldvalue_show}></span>
                            <input type="hidden" name="<{$item.unit_name}>" value="<{$item.fieldvalue}>" id="unit_size">
                            <div class="the-arrow the-arrow-normal" id="the-arrow-size"></div>
                        </div>
                        <div id="edt_ctr_size_g" class="">
                            <div id="edt_ctr_size" class="edt_dropdown">
                                <{foreach $item.unit_value_arr as $result}>
                                    <span class="ring_size" sizevalue="<{$result.key}>"><{$result.value}></span>
                                <{/foreach}>
                               <!-- <span class="ring_size">01</span>
                                <span class="ring_size">02</span>
                                <span class="ring_size">03</span>
                                <span class="ring_size">04</span>
                                <span class="ring_size">05</span>
                                <span class="ring_size">06</span>
                                <span class="ring_size">07</span>
                                <span class="ring_size">08</span>
                                <span class="ring_size">09</span>-->
                            </div>
                        </div>
                    </div>
                <{/if}>
            <{/foreach}>
        </div>
        <div class="btn_box">
            <button type="button" class="btn-buy btn-default arcbuynow"  id="web3dSaveBuy" data-loading-text="<span class='' aria-hidden='true' style='display:inline-block;float:left;height:45px;line-height:45px;padding:0 5px 0 0;'>
            <img src='__NEOSTATIC__/imgs/jewelry/loading.gif' width='20' height='20'/></span>正在提交..." autocomplete="off">放入购物袋</button>
            <input type="hidden" value="<{$udinfo.id}>" name="pid" id="pid"></p>
            <input type="hidden" value="<{$udinfo.cover}>" name="cover" id="cover">
            <input type="hidden" value="<{$dataAll.diy_cate.cid}>" name="cid" id="cid">
            <input type="hidden" value="<{$udinfo.price}>" name="price" id="price">
            <input type="hidden" value="0" id="stype" name="stype">
        </div>
        <div class="my_operation">
            <a href="javascript:void(0);"  class="btn_save" id="web3dSave" >保存我的方案</a>
            <i></i>
           <!-- <a href="javascript:;" class="btn_share">分享</a>-->
        </div>
    </div>
</form>
</div>
<{if $dataAll.diy_cate.cid eq 40}>
    <{$projNum=2}>
<{else}>
    <{$projNum=1}>
<{/if}>
<script type="text/javascript">



    seajs.use(["3dcity/earrings/ZEntry.js", "common/gui/ZDDDPublic"], function (ZEntry, ZDDDPublic) {

        $('.edt_diamonds_pos').attr('metal',$('#material').val());

        var _parent = document.getElementById("edt_preview"), i = 0;

        var dddPublic = new ZDDDPublic(_parent);

        dddPublic.activePart1($('.edt_diamonds_pos'), false);
        var diamondPrice=<{$diamondPriceJson}>;
        getprice(diamondPrice);

        <{if $dataAll.diy_cate.cid eq 48}>
        // Set arrow position
        var arrow_start_offset = 90;
        var setArrowOffset = function(offset) {
            $(".arrow").animate({left : offset});
        };
        setArrowOffset(arrow_start_offset);
        $(".edt_pos_diamond").each(function () {
            $(this).bind("click", function() {
                setArrowOffset(arrow_start_offset + parseInt($(this).attr("posnum")) * arrow_start_offset);
            });
        });
        <{/if}>

        $(".edt_shop_diamond").each(function () {
            $(this).on("click", function(event) {
                dddPublic.activeDiamondBarDown($(this));
                var pos = this.getAttribute('pos');
                var price=this.getAttribute('dp');
                diamondPrice[pos]['diamond_price']=price;
                getprice(diamondPrice);
                event.stopPropagation();
            });
        });

        $("#part_unit_metal").on("click", function (event) {
            <{if $dataAll.diy_cate.cid neq 48}>
                dddPublic.activeCom($("#edt_ctr_metal_g"), $("#the-arrow-metal"));
            <{else}>
                dddPublic.activeCom($("#edt_ctr_metal"), $("#the-arrow-metal"));
            <{/if}>
            event.stopPropagation();

        });

        $(".edt_metal_c").each(function () {
            $(this).on("click", function (event) {
                dddPublic.activeMetalBar($(this));
                var currentMaterial=this.getAttribute('idx');
                $('#material').val(currentMaterial);
                event.stopPropagation();
            });
        });

        function getprice(priceArr){
            var price=0;
            for(key in priceArr){
                price = price + (parseInt(priceArr[key]['price']) + parseInt(priceArr[key]['diamond_price']) * parseInt(priceArr[key]['diamond_num']))*parseInt(priceArr[key]['visiable']);
            }
            document.getElementById('showprice').innerHTML=price;
            document.getElementById('price').value=price;
        }


        $("#part_unit_size").on("click", function (event) {

            dddPublic.activeCom($("#edt_ctr_size"), $("#the-arrow-size"));
            event.stopPropagation();
        });
        $(".ring_size").each(function() {
            $(this).on("click", function (event) {
                $("#sizeCurrentText").html($(this).html());
                var sizevalue=$(this).attr("sizevalue");
                $("#unit_size").val(sizevalue);
                event.stopPropagation();
            });
        });
        var inParas = {
            projectName: "__DOC__<{$dataAll.diy_cate.jspath}>",
            projectName_nowebgl: "__DOC__<{$dataAll.diy_cate.jspath_nowebgl}>",
            <{if $dataAll.diy_cate.cameramatrix}>
                cameraMatrixArray :   <{$dataAll.diy_cate.cameramatrix}>,
            <{/if}>
            elementParent : _parent
       };
        var zEntry = new ZEntry(inParas);

    });
</script>


</body>
</html>