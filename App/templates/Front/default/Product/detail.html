<{include file=C('AHEAD_START')}>
<link rel="stylesheet" href="__NEOSTATIC__/css/layerslider.css" type="text/css"> 
<script src="__NEOSTATIC__/js/greensock.js"></script> 
<script src="__NEOSTATIC__/js/layerslider.transitions.js"></script> 
<script src="__NEOSTATIC__/js/layerslider.kreaturamedia.jquery.js"></script>  
<script src="__NEOSTATIC__/js/es5-shim.js"></script>
<{include file=C('AHEAD_END')}> 
<div class="prd container">
	<div class="breadcrumb"><a class="home" href="#">珠宝首饰</a>\<a href="#">戒指</a></div>
	<div class="prd-titile hla">
		<h2><{$Product.p_name}></h2>
	</div>
	<div class="clear"></div>
		<div class="prd-gal-holder">
		<div class="prd-gal" style="width: 560px; height: 420px; max-width: 560px;">
			<{foreach $ProductPhotoList as $ProductPhoto name="foo"}> 
			<div class="ls-slide"> 
				<img src="__DOC__<{$ProductPhoto.pp_path}>o/<{$ProductPhoto.pp_filename}>" class="ls-bg" alt="Slide background">
			</div>
			<{/foreach}>
		</div>
	</div>
	<!-- miaomin disabled@2015.10.30
	<div class="tablayer layer-info">
		<div class="prd-info-holder">	
			<div class="prd-info">
				<p><{$Product.p_mini}></p>
				<div class="buildit">
					<button class="btn btn-action" id="go-ordergen"><i>现在开始定制<span>￥<b><{$Product.p_gprice|number_format}>.00</b> 起</span></i></button>
				</div>
				<div class="author">
					<span class="powered">By</span><img src="__UPLOAD__/avatar/<{$Product.u_avatar|replace:'/o/':'/s/96_96_'}>" class="avatar">
					<div class="author-info">
						<h4><{$Product.u_dispname}></h4>
					</div>
				</div>
			</div>
		</div>
	</div>
	 -->
	<div class="tablayer layer-ordergen">
		<div class="prd-info-holder">
			<div class="prd-ordergen">
				<h4>现在订购</h4>
				<div class="tr bucks">
					<h5 class="first"></h5>
				</div>
				<{if $RelationProductList|@count}>
				<div class="tr relation">
					<h5 class="jstitle gen"><i>相关商品</i></h5>
					<div class="radiogroup" id="rdgrp-relation-div">
						<{foreach $RelationProductList as $RelationProduct name="foo"}>
							<{if $RelationProduct.p_default == 1}>
								<input type="radio" class="rdgrp-relation-radio" id="rdgrp-<{$RelationProduct.p_id}>" name="relationid" price="<{$RelationProduct.p_price}>" value="<{$RelationProduct.p_id}>" checked="checked"><label for="rdgrp-<{$RelationProduct.p_id}>"><{$RelationProduct.p_name}></label></li>
							<{else}>
								<input type="radio" class="rdgrp-relation-radio" id="rdgrp-<{$RelationProduct.p_id}>" name="relationid" price="<{$RelationProduct.p_price}>" value="<{$RelationProduct.p_id}>"><label for="rdgrp-<{$RelationProduct.p_id}>"><{$RelationProduct.p_name}></label></li>
							<{/if}>
						<{/foreach}>
					</div>
				</div>
				<{/if}>
				<div class="buildit">
					<div class="review"><span class="costs">每件最低 ￥<b><{$Product.p_gprice|number_format}></b>.00起，</span><span class="counts">份数<input value="1" class="input" id="buycount"><{$Product.p_unitname|default:'个'}></span></div>
					<{if $isLogin}>
						<button class="btn btn-action" id="buy_href"><i>加入购物车</i></button>
					<{else}>
						<button class="btn btn-action" id="go-ordergen" onClick="goLogin()"><i>加入购物车</i></button>
					<{/if}>
					<input type="hidden" class="pid" id="pid" name="pid" value="">
					<input type="hidden" class="pprice" id="pprice" name="pprice" value="">
				</div>
			</div>
		</div>
	</div>	
	<!-- div class="prd-gal-holder">
		<div class="prd-gal" style="width: 560px; height: 420px; max-width: 560px;">
			<{foreach $ProductPhotoList as $ProductPhoto name="foo"}> 
			<div class="ls-slide"> 
				<img src="__DOC__<{$ProductPhoto.pp_path}>o/<{$ProductPhoto.pp_filename}>" class="ls-bg" alt="Slide background">
			</div>
			<{/foreach}>
		</div-->
	</div>
	<div class="clear"></div>
	
	<!--div class="prd-diyframe"> 
		<iframe class="webeditor" scrolling="no" allowfullscreen="true" src="/city/index.php/diy-jewelryeditall-pid-0-cid-14-showtype-0.html"></iframe> 
	</div-->
	
	<{if $Product.p_intro}>
	<div class="dividing">
		<h2><label class="skew"><i>商品介绍</i></label></h2>
	</div>
	
	<div class="contentex">
		<{$Product.p_intro}>
	</div>
	<{/if}>
	
	<div class="dividing">
		<h2><label class="skew"><i>精美的包装</i></label></h2>
	</div> 	
	
	<div class="box1">
		<img src="__NEOSTATIC__/imgs/jewelry/f/box1.jpg" alt=""/>
		<h3></h3>
	</div>

	<div class="dividing">
		<h2><label class="skew"><i>更多推荐</i></label></h2>
	</div>
	<div class="prdlist size-lg" >
		<ul class="prdlist-gird">
			<{foreach $SearchResult as $Result name="foo"}>
			<li> <a href="__DOC__/index/product-detail-id-<{$Result['p_id']}>.html" class="item-img"><img src="__IMG__<{$Result['p_cover']|replace:'/o/':'/s/240_180_'}>" alt=""/>
			<!-- 
				<span class="skew"><i>DIY</i></span>
			-->
				</a>
				<div class="item-info">
					<h4><a href="__DOC__/index/product-detail-id-<{$Result['p_id']}>.html" title="<{$Result['p_name']}>"><{$Result['p_name']}></a></h4>
					<span class="item-price">￥<b><{$Result['p_price']|number_format}></b>.00</span> </div>
			</li>
			<{/foreach}>
		</ul>
		<div class="clear"></div>
		<a href="__APP__/jewelry-jewelrylist" class="btn-more">&gt;<i>浏览更多款式</i>&lt;</a>
	</div>
	<ul class="advantage">
		<li class="one">
			<div>
				<h3>精湛工艺</h3>
				<p>可能是您买的到的最高品质3D打印产品，快来亲身体验吧。</p>
			</div>
		</li>
		<li class="two">
			<div>
				<h3>高效物流</h3>
				<p>十天内，我们会完成制作并免费将您订制的专属物件送达。</p>
			</div>
		</li>
		<li class="three">
			<div>
				<h3>完美保证</h3>
				<p>我们承诺将您的商品完好送达，如有运输中的损坏，我们将负责调换。</p>
			</div>
		</li>
	</ul>
	<div class="clear"></div>
</div>



<div class="frm-img frm-img_ring pa" ><a href="javascript:void(0)" class="clos" >X</a></div>
<!--
<div class="frm-img frm-img_nec pa" ><a href="javascript:void(0)" class="clos" >X</a></div>
-->

<style>
    .diy-inf{border-radius:100%;background:#D6F0E8;width:20px;height:20px;line-height:15px;text-align:center;margin-top:5px;display:inline-block;border:1px solid #4EBF9A; vertical-align:middle;margin-top:-5px;}
    .frm-img{display:none;top:50%;left:50%;margin-left:-360px;margin-top:-260px;width:800px;height:600px;border:1px solid #999;z-index:40000;}
    .frm-img img{width:100%;height:100%;}
    .frm-img a{display:block;text-align:right;width:100%;position:relative;z-index:44444;font-size:25px;font-weight:bold;color:#7FD1BA;}
    .frm-img_nec{background:url(__NEOSTATIC__/imgs/jewelry/frm-img_nec.jpg) center center no-repeat;background-size:cover;}
    .frm-img_ring{background:url(__NEOSTATIC__/imgs/jewelry/frm-img_rin.jpg) center center no-repeat;background-size:cover;}
</style>
<script type="text/javascript">
function initfrmabc(){
    $(".frm-img_ring").fadeToggle();
}
$(".clos").click(function(){
    $(".frm-img").hide();
});

/*$(".diy-inf.nck").click(function(){
    $(".frm-img_nec").fadeToggle();
});
$(".diy-inf.rin").click(function(){
    $(".frm-img_ring").fadeToggle();
});
$(".diy-rin").click(function(){
    $(".frm-img_ring").fadeToggle();
});
$(".diy-nck").click(function(){
    $(".frm-img_nec").fadeToggle();
});*/
</script>
<script>
$(document).ready(function(e) {
	$(".prd-gal").layerSlider({
		pauseOnHover: false,
		navStartStop: false,
		showCircleTimer: false,
		skin: 'fullwidth',
        skinsPath: '__NEOSTATIC__/js/ls-skins/'
	});
	$("#go-ordergen").click(function(e) {
		$(".layer-info").fadeOut(500);
		$(".layer-ordergen").delay(600).fadeIn(300);
	});
	$(".author").delay(1000).fadeTo(500, 1);

// === Starting Order Generator === 
/*************************
谨以此诗献给小顾

这是勇敢的海燕，在怒吼的大海上，在闪电中间，高傲地飞翔；这是胜利的预言家在叫喊： 

——让暴风雨来得更猛烈些吧！
*************************/

	// 属性选择器数组
	var json = new Array();
	json[0] = <{$Selector}>;
	
	// 属性值映射列表
	var provallist = <{$PropValList}>;
	
	// 属性列表带排序
	var proplist = <{$PropList}>;
	
	$('.first').html("<i>" + proplist[0]["ipp_name"] + "</i>").addClass("gen");
	
	// 是否有尺码下拉菜单选择
	var hasSizeSelector = 0;
	
	if( proplist[0]["ipp_name"] != '号码' ){
		
		// 全RADIO
		
		// $('.num').css('display','none');
		
		var j = 0;
		var p = 1;
		
		var tempDiv = '<div class="tr jam"><h5 class="jstitle"></h5><div class="radiogroup" id="rdgrp-0">';
		
		for(var key in json[0] ){
			
			tempDiv += '<input type="radio" class="rdgrp-22" id="rdgrp-0-'+p+'" name="rdgrp-0" ref="0" value="'+key+'"><label for="rdgrp-0-'+p+'" class="rdgrp-222">'+provallist[key]+'</label>';
			
			p++;
			
		}
		
		tempDiv += '</div></div>';
		
		$('.prd-ordergen').find('.tr:eq(0)').after(tempDiv);
		
		$( ".radiogroup" ).buttonset();
		
	} else {

		hasSizeSelector = 1;
		
		var j = 0;
		var p = 1;
		
		// 初始化第一个下拉菜单选择器
		var tempDiv = '<div class="tr num"><div class="selectmenu"><select name="radius" id="radius" ref="0" class="selectgroup fkk">';
		tempDiv += '<option value="0">请选择'+proplist[0]["ipp_name"]+'</option>';
	
		// 通过一个循环添加所有选项
		for(var key in json[0] ){
			
			tempDiv += '<option  value="'+key+'">'+provallist[key]+'</option>';
			
			p++;
			
		}
		tempDiv += '</select></div><a href="javascript:void(0);onClick=initfrmabc();" class="infolink rin">教您如何测量尺寸 &gt;</a></div>';

		// 添加下拉菜单选择器
		$('.prd-ordergen').find('.tr:eq(0)').after(tempDiv);
		
		// 下拉菜单选择器事件绑定
		$('.prd-ordergen').delegate("#radius",'change',function(){
			// 选中的值
			var json_val = $(this).val();
			
			// 层级
			var ref_val = parseInt($(this).attr("ref"));
			
			var nxt_refval = ref_val + 1;
			
			var nnxt_refval = nxt_refval + 1;
			
			// 每次点击后pid的数据必须清空
			$('.pid').val('');

			// 必要的数据清空否则可能出现迭代出现
			$('.prd-ordergen').find('.tr.jam').remove();
			
			// 如果值不为0
			if (json_val != 0){
				
				json[nxt_refval] = json[ref_val][ json_val];

				var tempDiv = '<div class="tr jam"><h5 class="jstitle gen"><i>' + proplist[nxt_refval]["ipp_name"] + '</i></h5><div class="radiogroup" id="rdgrp-'+nxt_refval+'">';
				
				var p=1;
				
				// 最后一层
				if (Object.keys(json[nxt_refval]).length == 1){
					
					for(var key in  json[nxt_refval] ){
					
						if(key!='p_id' && key!='p_price'){
		    				tempDiv += '<input type="radio" class="rdgrp-22" id="rdgrp-'+nxt_refval+'-'+p+'" name="rdgrp-'+nxt_refval+'" ref="'+nxt_refval+'" value="'+key+'"><label for="rdgrp-'+nxt_refval+'-'+p+'" class="rdgrp-222">'+provallist[key]+'</label></li>';
						} else {
						}
						
						tempDiv += '</div></div>';
						
						$('.prd-ordergen').find('.tr:eq('+nxt_refval+')').after(tempDiv);
					
						$( ".radiogroup" ).buttonset();
						
						// console.info('rdgrp-'+nxt_refval+'-'+p);
						
						$('#rdgrp-'+nxt_refval+'-'+p).trigger("click");
					
						p++;
					}
				}else{
					for(var key in  json[nxt_refval] ){
						if(key!='p_id' && key!='p_price'){
				    		tempDiv += '<input type="radio" class="rdgrp-22" id="rdgrp-'+nxt_refval+'-'+p+'" name="rdgrp-'+nxt_refval+'" ref="'+nxt_refval+'" value="'+key+'"><label for="rdgrp-'+nxt_refval+'-'+p+'" class="rdgrp-222">'+provallist[key]+'</label></li>';
						} else {
						}
							
						p++;	
					}
					
					tempDiv += '</div></div>';
					
					$('.prd-ordergen').find('.tr:eq('+nxt_refval+')').after(tempDiv);
					
					$( ".radiogroup" ).buttonset();
				}
			}
		});
	}
	
	// 属性选择器 Radio Click事件绑定
	$(".prd-ordergen").delegate(".rdgrp-22",'click',function(){	
		
		var json_val = $(this).val();
		
		var ref_val = parseInt($(this).attr("ref"));
		
		var nxt_refval = ref_val + 1;
		
		var nnxt_refval = nxt_refval + 1; 
		
		json[nxt_refval] = json[ref_val][ json_val];
		
		// console.info(json);
		
		if ('p_id' in json[nxt_refval]){
			// 最后一层
      		 $('.pid').val(json[nxt_refval]['p_id']);
      		 $('.pprice').val(json[nxt_refval]['p_price']);
			
			// 需要加上关联商品价格
       		// $('.costs').html('每件 ￥<b>' + json[nxt_refval]['p_price'] + '</b>.00，');
			<{if $RelationProductList|@count}>
				var totalprice = 0;
				var relationprice = $("input[name='relationid']:checked").attr("price");
				// console.info('RelationPrice:' + relationprice);
				totalprice = parseInt(json[nxt_refval]['p_price']) + parseInt(relationprice);
				$('.costs').html('每件 ￥<b>' + totalprice + '</b>.00，');
			<{else}>
				$('.costs').html('每件 ￥<b>' + json[nxt_refval]['p_price'] + '</b>.00，');
			<{/if}>
			
			 return;
		}else{
			var removeJam;
			
			// 每次点击后pid的数据必须清空
			$('.pid').val('');
			
			removeJam = ref_val - hasSizeSelector;
			// console.info('REMOVE_JAM:' + removeJam);
			$('.prd-ordergen').find('.tr.jam:gt('+removeJam+')').remove();
			
			var tempDiv = '<div class="tr jam"><h5 class="jstitle gen"><i>' + proplist[nxt_refval]["ipp_name"] + '</i></h5><div class="radiogroup" id="rdgrp-'+nxt_refval+'">';			
		}
		
		var p=1;
		
		if (Object.keys(json[nxt_refval]).length == 1){
			
			for(var key in  json[nxt_refval] ){
			
				if(key!='p_id' && key!='p_price'){
    				tempDiv += '<input type="radio" class="rdgrp-22" id="rdgrp-'+nxt_refval+'-'+p+'" name="rdgrp-'+nxt_refval+'" ref="'+nxt_refval+'" value="'+key+'"><label for="rdgrp-'+nxt_refval+'-'+p+'" class="rdgrp-222">'+provallist[key]+'</label></li>';
				} else {
				}
				
				tempDiv += '</div></div>';
				
				$('.prd-ordergen').find('.tr:eq('+nxt_refval+')').after(tempDiv);
			
				$( ".radiogroup" ).buttonset();
				
				// console.info('rdgrp-'+nxt_refval+'-'+p);
				
				$('#rdgrp-'+nxt_refval+'-'+p).trigger("click");
			
				p++;
			}
		}else{
			for(var key in  json[nxt_refval] ){
				if(key!='p_id' && key!='p_price'){
		    		tempDiv += '<input type="radio" class="rdgrp-22" id="rdgrp-'+nxt_refval+'-'+p+'" name="rdgrp-'+nxt_refval+'" ref="'+nxt_refval+'" value="'+key+'"><label for="rdgrp-'+nxt_refval+'-'+p+'" class="rdgrp-222">'+provallist[key]+'</label></li>';
				} else {
				}
					
				p++;	
			}
			
			tempDiv += '</div></div>';
			
			$('.prd-ordergen').find('.tr:eq('+nxt_refval+')').after(tempDiv);
			
			$( ".radiogroup" ).buttonset();
		}
	});
	
	// 相关商品 Radio Click事件绑定
	$(".prd-ordergen").delegate(".rdgrp-relation-radio",'click',function(){
		if ($('.pid').val() != ""){
			var totalprice = 0;
			var relationprice = $("input[name='relationid']:checked").attr("price");
			totalprice = parseInt($('.pprice').val()) + parseInt(relationprice);
			$('.costs').html('每件 ￥<b>' + totalprice + '</b>.00，');
		}
	});
});  
</script>
<script type="text/javascript">
$(document).ready(function(e) {
	
  // $(".ajaxinfo").hide();
	
  var buy_href_ajax_url = '__APP__/cart-additem';
	
//购买的AJAX调用
  $("#buy_href").click(function(event){
	  var pid = $(".pid").val();
	  
	  if (pid == ''){
		  alert('请正确选择饰品的尺寸或材质信息后再次提交');
		  return;
	  }
	  
	  if (($("#buycount").val() < 1) || ($("#buycount").val() > 99)){
		 alert( '请正确填写份数' );
		 return ;	  
	  }
	  
	 $.ajax({
	   url: buy_href_ajax_url,
	   type:'get',
       cache:false,
       dataType:'json',
       data:{
		    pid : $(".pid").val(),
			isreal : 1,
			count : $("#buycount").val(),
			// count : 2,
	   },
	   success: function(data,textStatus){
	   		if(data.isSuccess == true){
	           //加入购物车成功
			   location.href= "__DOC__/user.php/cart";
	           return;
	         }else{
			   //加入购物车失败
			   location.href= "__DOC__/user.php/cart";
			   return;
	         }
	       },
	       error: function(Request,Status,Error) {alert(Request + '|' + Status + '|' +Error);}
	});
  });	 
});

$("#buycount").keydown(function (e) {
    // Allow: backspace, delete, tab, escape, enter and .
    if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
         // Allow: Ctrl+A
        (e.keyCode == 65 && e.ctrlKey === true) || 
         // Allow: home, end, left, right
        (e.keyCode >= 35 && e.keyCode <= 39)) {
             // let it happen, don't do anything
             return;
    }
    // Ensure that it is a number and stop the keypress
    if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
        e.preventDefault();
    }
});

function goLogin(){
	location.href= "__DOC__/user.php/login?from_url=__SELF__";
}
</script>
<{include file=C('AFOOT')}>